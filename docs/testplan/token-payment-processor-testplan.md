# Token Payment Processor Testplan

&nbsp;

## Background
This testplan is going to cover the token payment processor, it will go over must haves and additional features that we can add on later. 

UI relating to token payment processing can be seen on [Billing Page](https://www.figma.com/file/HlmasFJNHxs2lzGerq3WYH/Satellite-GUI-Public?node-id=11080%3A68109) figma design.

&nbsp;

&nbsp;

<google-sheets-html-origin><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->

| Test Scenario |               Test Case              |                                                                                                                                                Description                                                                                                                                               |                                                                        Comments                                                                        |
|:-------------:|:------------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------------------------------------------------------------:|
| Transaction   | Block Chain Reorg                    | If there is a naturally occurring chain reorg then past transactions in the old chain are deactivated due to a chain reorganization (this should be visible in UI, pending to cancelled)                                                                                                                 | Must have early on (Alpha)                                                                                                                             |
|               | Transaction Override                 | If a user overrides the first transaction with a higher transaction fee, then the token payment processor has to replace the transaction hash it is watching (this should be visible in UI)                                                                                                              | Must have early on (Beta)                                                                                                                              |
|               | 0 Confirmation                       | If a user broadcasts a transaction into the mempool we should display it on the satellite UI as early as possible as a pending transaction with 0 confirmations for better user experience.                                                                                                              | Nice to have / (Beta)                                                                                                                                  |
|               | Minimum Confirmation                 | A transaction should not be called paid unless it meets the minimum number of confirmations reached (this should be visible in UI, pending until it meets minimum number of confirmations)                                                                                                               | Must have early on (Alpha)                                                                                                                             |
|               | Cancel Transaction- 0 Confirmations  | User has a pending transaction and it has 0 confirmations, the user can cancel the transaction from their wallet by overriding it with a higher transaction fee with a different destination (change should be visible on UI, can show as either canceled or entirely dropped in UI)                     | Must have early on (Beta)                                                                                                                              |
|               | Transaction Fee Warning              | A general warning message should be shown in the UI regarding low transaction fees and explain to users that if the fee is too low then there is a possibility that the transaction will be reverted (their gas fee won't be given back) or delayed                                                      | Nice to have                                                                                                                                           |
|               | Multiple Transactions                | If a user has a pending transaction and then performs another transaction with a higher nonce using the same address, the new transaction has to wait until the previous transaction with the lower nonce is confirmed (standard behavior of geth, nothing to test for us)                               | Nothing to test. Keeping it in for documentation.                                                                                                      |
| Alerts        | Resynced Geth Node                   | Geth nodes should be able to sync with the network, if a geth node resyncs it can take several days and so the token payment processor should pick up transactions during this resync. It should apply the USD value by the time the transaction hits the blockchain and not by the time we proccess it. | Must have early on (Beta)                                                                                                                              |
| UI            | Block Explorer Link                  | We should be able to view transaction link and number of confirmations given a link to block explorer                                                                                                                                                                                                    | Must have early on (Alpha)                                                                                                                             |
|               | Conversion Rate                      | When user adds storj token as payment method, token should convert to USD in total balance with 10 percent bonus added on top                                                                                                                                                                            | Must have early on- Token should convert to USD otherwise it can cause some problems f.e person wants to charge back when token buying power increases |
|               | Transaction Detail                   | If user makes a transaction user should be able to see ethereum scaling solution used for said transaction (view details)                                                                                                                                                                                | Needed later when we implement zkSync                                                                                                                  |
| Testing       | Recreate Transactions                | Using sender, receiver, nonce, and transaction fees we should be able to recreate transactions to see if there are any mempool bugs and this should also be doable using storj-up                                                                                                                        | Must have early on for testing                                                                                                                         |
|               | Integrating Storj-scan into Storj-up | For ease of testing it would be valuable to have storj-scan built into storj-up (may need integration with satellite for us to test)                                                                                                                                                                     | Can be implemented later                                                                                                                               |
|               | Storj-scan with testnet              | As stated above, token payment processor has to work with testnet to be able to run in storj-up and use existing testnet geth node                                                                                                                                                                       | Can be implemented                                                                                                                                     |
